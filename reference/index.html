
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Reference - LMA</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lma.resample" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LMA" class="md-header__button md-logo" aria-label="LMA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LMA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LMA" class="md-nav__button md-logo" aria-label="LMA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LMA
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../rat_retina/" class="md-nav__link">
        Tutorial 1 - Rat retina
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../zebrafish_retina/" class="md-nav__link">
        Tutorial 2 - Zebrafish retina
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mouse_blastocyst/" class="md-nav__link">
        Tutorial 3 - Mouse blastocyst
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lma.resample" class="md-nav__link">
    lma.resample
  </a>
  
    <nav class="md-nav" aria-label="lma.resample">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lma.resample--lmaresample" class="md-nav__link">
    lma.resample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.multi_dataset_resample_trees" class="md-nav__link">
    multi_dataset_resample_trees()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.read_dataset" class="md-nav__link">
    read_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_doublets" class="md-nav__link">
    resample_trees_doublets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_quartets" class="md-nav__link">
    resample_trees_quartets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_triplets" class="md-nav__link">
    resample_trees_triplets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot" class="md-nav__link">
    lma.plot
  </a>
  
    <nav class="md-nav" aria-label="lma.plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lma.plot--lmaplot" class="md-nav__link">
    lma.plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.dfs_for_plotting" class="md-nav__link">
    dfs_for_plotting()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.make_color_dict" class="md-nav__link">
    make_color_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.multi_dataset_dfs_for_plotting" class="md-nav__link">
    multi_dataset_dfs_for_plotting()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.multi_dataset_plot_deviation" class="md-nav__link">
    multi_dataset_plot_deviation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.plot_deviation" class="md-nav__link">
    plot_deviation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.plot_frequency" class="md-nav__link">
    plot_frequency()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lma.resample" class="md-nav__link">
    lma.resample
  </a>
  
    <nav class="md-nav" aria-label="lma.resample">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lma.resample--lmaresample" class="md-nav__link">
    lma.resample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.multi_dataset_resample_trees" class="md-nav__link">
    multi_dataset_resample_trees()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.read_dataset" class="md-nav__link">
    read_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_doublets" class="md-nav__link">
    resample_trees_doublets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_quartets" class="md-nav__link">
    resample_trees_quartets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.resample.resample_trees_triplets" class="md-nav__link">
    resample_trees_triplets()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot" class="md-nav__link">
    lma.plot
  </a>
  
    <nav class="md-nav" aria-label="lma.plot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lma.plot--lmaplot" class="md-nav__link">
    lma.plot
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.dfs_for_plotting" class="md-nav__link">
    dfs_for_plotting()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.make_color_dict" class="md-nav__link">
    make_color_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.multi_dataset_dfs_for_plotting" class="md-nav__link">
    multi_dataset_dfs_for_plotting()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.multi_dataset_plot_deviation" class="md-nav__link">
    multi_dataset_plot_deviation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.plot_deviation" class="md-nav__link">
    plot_deviation()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lma.plot.plot_frequency" class="md-nav__link">
    plot_frequency()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reference</h1>

<p>This part of the project documentation focuses on
an <strong>information-oriented</strong> approach. Use it as a
reference for the technical implementation of the
<code>lma</code> project code.</p>


<div class="doc doc-object doc-module">


<a id="lma.resample"></a>
  <div class="doc doc-contents first">
  
      <h3 id="lma.resample--lmaresample">lma.resample</h3>
<p>Provides functions for resampling tree datasets.</p>
<p>This module contains the following functions:</p>
<ul>
<li><code>read_dataset</code> - Returns sorted tree dataset.</li>
<li><code>resample_trees_doublets</code> - Returns subtree dictionary and DataFrame containing number of <strong>doublets</strong> across all resamples, the original trees, and the expected number (solved analytically).</li>
<li><code>resample_trees_triplets</code> - Returns subtree dictionary and DataFrame containing number of <strong>triplets</strong> across all resamples, the original trees, and the expected number (solved analytically).</li>
<li><code>resample_trees_quartets</code> - Returns subtree dictionary and DataFrame containing number of <strong>quartets</strong> across all resamples, the original trees, and the expected number (solved analytically).</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="lma.resample.multi_dataset_resample_trees" class="doc doc-heading">
<code class="highlight language-python"><span class="n">multi_dataset_resample_trees</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">dataset_names</span><span class="p">,</span> <span class="n">subtree</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs resampling of trees, drawing with or without replacement, returning number of subtrees across
    all resamples, the original trees, and the expected number (solved analytically) 
    <strong>for multiple datasets</strong>. The cell fates used are the composite set across all datasets provided.</p>
<p>Resampling is done as described in each of the <code>resample_trees_subtrees</code> functions.
If <code>cell_fates</code> not explicitly provided, use automatically determined cell fates based on tree datasets.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>datasets</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a path to txt file of dataset. 
txt file should be formatted as NEWICK trees separated with semi-colons and no spaces</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_names</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing the dataset label. </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>subtree</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>type of subtree to be analyzed. Should be 'doublet', 'triplet', or 'quartet'.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resample datasets.</p></td>
          <td>
                <code>10000</code>
          </td>
        </tr>
        <tr>
          <td><code>replacement_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Sample cells with or without replacement drawing from the pool of all cells.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cell_fates</code></td>
          <td>
                <code>string or list</code>
          </td>
          <td><p>If 'auto' (i.e. not provided by user), automatically determined 
based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following variables.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>subtree_dict (dict): Keys are subtrees, values are integers.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>cell_fates (list): List where each entry is a string representing a cell fate.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>dfs_dataset_c (list): List where each entry is a DataFrame with the following characteristics.
Indexed by values from <code>subtree_dict</code>.
Last column is dataset label.
Second to last column is analytically solved expected number of each subtree.
Third to last column is observed number of occurences in the original dataset.
Rest of columns are the observed number of occurences in the resampled sets.</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/resample.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multi_dataset_resample_trees</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span>
                                 <span class="n">dataset_names</span><span class="p">,</span>
                                 <span class="n">subtree</span><span class="p">,</span>
                                 <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> 
                                 <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                                 <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                 <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs resampling of trees, drawing with or without replacement, returning number of subtrees across</span>
<span class="sd">        all resamples, the original trees, and the expected number (solved analytically) </span>
<span class="sd">        **for multiple datasets**. The cell fates used are the composite set across all datasets provided.</span>

<span class="sd">    Resampling is done as described in each of the `resample_trees_subtrees` functions.</span>
<span class="sd">    If `cell_fates` not explicitly provided, use automatically determined cell fates based on tree datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        datasets (list): List where each entry is a path to txt file of dataset. </span>
<span class="sd">            txt file should be formatted as NEWICK trees separated with semi-colons and no spaces</span>
<span class="sd">        dataset_names (list): List where each entry is a string representing the dataset label. </span>
<span class="sd">        subtree (string): type of subtree to be analyzed. Should be &#39;doublet&#39;, &#39;triplet&#39;, or &#39;quartet&#39;.</span>
<span class="sd">        num_resamples (int, optional): Number of resample datasets.</span>
<span class="sd">        replacement_bool (bool, optional): Sample cells with or without replacement drawing from the pool of all cells.</span>
<span class="sd">        cell_fates (string or list, optional): If &#39;auto&#39; (i.e. not provided by user), automatically determined </span>
<span class="sd">            based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following variables.</span>
<span class="sd">        - subtree_dict (dict): Keys are subtrees, values are integers.</span>
<span class="sd">        - cell_fates (list): List where each entry is a string representing a cell fate.</span>
<span class="sd">        - dfs_dataset_c (list): List where each entry is a DataFrame with the following characteristics.</span>
<span class="sd">            Indexed by values from `subtree_dict`.</span>
<span class="sd">            Last column is dataset label.</span>
<span class="sd">            Second to last column is analytically solved expected number of each subtree.</span>
<span class="sd">            Third to last column is observed number of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed number of occurences in the resampled sets.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># automatically determine cell fates if not explicitly provided</span>
    <span class="k">if</span> <span class="n">cell_fates</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">all_trees_sorted_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
            <span class="n">all_trees_sorted</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
            <span class="n">all_trees_sorted_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">)</span>
        <span class="n">all_trees_sorted_list_flattened</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_trees_sorted_list</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">cell_fates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[A-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_trees_sorted_list_flattened</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])))))</span>

    <span class="c1"># _make_subtree_dict functions can only handle 10 cell fates max</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning!&#39;</span><span class="p">)</span>

    <span class="c1"># next, resample each dataset using composite cell fates list</span>
    <span class="n">dfs_dataset_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">datasets</span><span class="p">)):</span>
        <span class="n">all_trees_sorted</span> <span class="o">=</span> <span class="n">read_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;doublet&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_dataset</span><span class="p">)</span> <span class="o">=</span> <span class="n">resample_trees_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                                                          <span class="n">num_resamples</span><span class="p">,</span> 
                                                          <span class="n">replacement_bool</span><span class="p">,</span>
                                                          <span class="n">cell_fates</span><span class="o">=</span><span class="n">cell_fates</span>
                                                          <span class="p">)</span>
            <span class="n">dfs_dataset</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;triplet&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_dataset</span><span class="p">)</span> <span class="o">=</span> <span class="n">resample_trees_triplets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                                                          <span class="n">num_resamples</span><span class="p">,</span> 
                                                          <span class="n">replacement_bool</span><span class="p">,</span>
                                                          <span class="n">cell_fates</span><span class="o">=</span><span class="n">cell_fates</span>
                                                          <span class="p">)</span>
            <span class="n">dfs_dataset</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;quartet&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_dataset</span><span class="p">)</span> <span class="o">=</span> <span class="n">resample_trees_quartets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                                                          <span class="n">num_resamples</span><span class="p">,</span> 
                                                          <span class="n">replacement_bool</span><span class="p">,</span>
                                                          <span class="n">cell_fates</span><span class="o">=</span><span class="n">cell_fates</span>
                                                          <span class="p">)</span>
            <span class="n">dfs_dataset</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

        <span class="n">dfs_dataset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dfs_dataset</span><span class="p">)</span>
    <span class="n">dfs_dataset_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs_dataset_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_dataset_c</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.resample.read_dataset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">read_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reads dataset txt file located at <code>path</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>path</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Path to txt file of dataset. txt file should be formatted as NEWICK trees 
separated with semi-colons and no spaces.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>all_trees_sorted</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing a tree in NEWICK format. 
Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/resample.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_dataset</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads dataset txt file located at `path`.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (string): Path to txt file of dataset. txt file should be formatted as NEWICK trees </span>
<span class="sd">            separated with semi-colons and no spaces.</span>

<span class="sd">    Returns:</span>
<span class="sd">        all_trees_sorted (list): List where each entry is a string representing a tree in NEWICK format. </span>
<span class="sd">            Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="n">all_trees_unsorted</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
    <span class="n">all_trees_sorted</span> <span class="o">=</span> <span class="p">[</span><span class="n">_sorted_quartets</span><span class="p">(</span><span class="n">_sorted_doublets</span><span class="p">(</span><span class="n">_align_triplets</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_trees_unsorted</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">all_trees_sorted</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.resample.resample_trees_doublets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resample_trees_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs resampling of trees, drawing with or without replacement, returning subtree dictionary and DataFrame containing
number of doublets across all resamples, the original trees, and the expected number (solved analytically).</p>
<p>Resampling is done by replacing each cell fate with a randomly chosen cell fate across all trees.
If <code>cell_fates</code> not explicitly provided, use automatically determined cell fates based on tree dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>all_trees_sorted</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing a tree in NEWICK format. 
Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resample datasets.</p></td>
          <td>
                <code>10000</code>
          </td>
        </tr>
        <tr>
          <td><code>replacement_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Sample cells with or without replacement drawing from the pool of all cells.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cell_fates</code></td>
          <td>
                <code>string or list</code>
          </td>
          <td><p>If 'auto' (i.e. not provided by user), automatically determined 
based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following variables.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>doublet_dict (dict): Keys are doublets, values are integers.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>cell_fates (list): List where each entry is a string representing a cell fate.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>dfs_c (DataFrame): Indexed by values from <code>doublet_dict</code>.
Last column is analytically solved expected number of each doublet.
Second to last column is observed number of occurences in the original dataset.
Rest of columns are the observed number of occurences in the resampled sets.</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/resample.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resample_trees_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                            <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> 
                            <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                            <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>
                            <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs resampling of trees, drawing with or without replacement, returning subtree dictionary and DataFrame containing</span>
<span class="sd">    number of doublets across all resamples, the original trees, and the expected number (solved analytically).</span>

<span class="sd">    Resampling is done by replacing each cell fate with a randomly chosen cell fate across all trees.</span>
<span class="sd">    If `cell_fates` not explicitly provided, use automatically determined cell fates based on tree dataset.</span>


<span class="sd">    Args:</span>
<span class="sd">        all_trees_sorted (list): List where each entry is a string representing a tree in NEWICK format. </span>
<span class="sd">            Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</span>
<span class="sd">        num_resamples (int, optional): Number of resample datasets.</span>
<span class="sd">        replacement_bool (bool, optional): Sample cells with or without replacement drawing from the pool of all cells.</span>
<span class="sd">        cell_fates (string or list, optional): If &#39;auto&#39; (i.e. not provided by user), automatically determined </span>
<span class="sd">            based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following variables.</span>
<span class="sd">        - doublet_dict (dict): Keys are doublets, values are integers.</span>
<span class="sd">        - cell_fates (list): List where each entry is a string representing a cell fate.</span>
<span class="sd">        - dfs_c (DataFrame): Indexed by values from `doublet_dict`.</span>
<span class="sd">            Last column is analytically solved expected number of each doublet.</span>
<span class="sd">            Second to last column is observed number of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed number of occurences in the resampled sets.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># automatically determine cell fates if not explicitly provided</span>
    <span class="k">if</span> <span class="n">cell_fates</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">cell_fates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[A-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])))))</span>

    <span class="c1"># _make_subtree_dict functions can only handle 10 cell fates max</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning!&#39;</span><span class="p">)</span>

    <span class="n">doublet_dict</span> <span class="o">=</span> <span class="n">_make_doublet_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>
    <span class="n">cell_dict</span> <span class="o">=</span> <span class="n">_make_cell_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>

    <span class="c1"># store result for each rearrangement in dfs list</span>
    <span class="n">dfs_doublets_new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_doublets_true</span> <span class="o">=</span> <span class="n">_make_df_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">df_all_cells_true</span> <span class="o">=</span> <span class="n">_make_df_all_cells</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">cell_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># rearrange leaves num_resamples times</span>
    <span class="k">for</span> <span class="n">resample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">)):</span>
        <span class="n">all_cells_true</span> <span class="o">=</span> <span class="n">_flatten_all_cells</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">)</span>

        <span class="c1"># shuffle if replacement=False</span>
        <span class="k">if</span> <span class="n">replacement_bool</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">all_cells_true</span><span class="p">)</span>

        <span class="n">new_trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">_replace_all</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">all_cells_true</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span><span class="p">]</span>
        <span class="n">df_doublets_new</span> <span class="o">=</span> <span class="n">_make_df_doublets</span><span class="p">(</span><span class="n">new_trees</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="n">resample</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">dfs_doublets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_doublets_new</span><span class="p">)</span>

    <span class="n">dfs_c</span> <span class="o">=</span> <span class="n">_process_dfs_doublet</span><span class="p">(</span><span class="n">df_doublets_true</span><span class="p">,</span> <span class="n">dfs_doublets_new</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="n">cell_dict</span><span class="p">,</span> <span class="n">df_all_cells_true</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">doublet_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_c</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.resample.resample_trees_quartets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resample_trees_quartets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs resampling of tree, drawing with or without replacement, returning subtree dictionary and DataFrame containing 
the number of quartets across all resamples, the original trees, and the expected number (solved analytically).</p>
<p>Resampling is done via replacing each doublet with a randomly chosen doublet from across all trees.
If <code>cell_fates</code> not explicitly provided, use automatically determined cell fates based on tree dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>all_trees_sorted</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing a tree in NEWICK format. 
Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resample datasets.</p></td>
          <td>
                <code>10000</code>
          </td>
        </tr>
        <tr>
          <td><code>replacement_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Sample cells with or without replacement drawing from the pool of all cells.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cell_fates</code></td>
          <td>
                <code>string or list</code>
          </td>
          <td><p>If 'auto' (i.e. not provided by user), automatically determined 
based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following variables.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>quartet_dict (dict): Keys are quartets, values are integers.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>cell_fates (list): List where each entry is a string representing a cell fate.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>dfs_c (DataFrame): Indexed by values from <code>quartet_dict</code>.
Last column is analytically solved expected number of each quartet.
Second to last column is observed number of occurences in the original dataset.
Rest of columns are the observed number of occurences in the resampled sets.</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/resample.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resample_trees_quartets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                            <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> 
                            <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>
                           <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs resampling of tree, drawing with or without replacement, returning subtree dictionary and DataFrame containing </span>
<span class="sd">    the number of quartets across all resamples, the original trees, and the expected number (solved analytically).</span>

<span class="sd">    Resampling is done via replacing each doublet with a randomly chosen doublet from across all trees.</span>
<span class="sd">    If `cell_fates` not explicitly provided, use automatically determined cell fates based on tree dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        all_trees_sorted (list): List where each entry is a string representing a tree in NEWICK format. </span>
<span class="sd">            Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</span>
<span class="sd">        num_resamples (int, optional): Number of resample datasets.</span>
<span class="sd">        replacement_bool (bool, optional): Sample cells with or without replacement drawing from the pool of all cells.</span>
<span class="sd">        cell_fates (string or list, optional): If &#39;auto&#39; (i.e. not provided by user), automatically determined </span>
<span class="sd">            based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following variables.</span>
<span class="sd">        - quartet_dict (dict): Keys are quartets, values are integers.</span>
<span class="sd">        - cell_fates (list): List where each entry is a string representing a cell fate.</span>
<span class="sd">        - dfs_c (DataFrame): Indexed by values from `quartet_dict`.</span>
<span class="sd">            Last column is analytically solved expected number of each quartet.</span>
<span class="sd">            Second to last column is observed number of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed number of occurences in the resampled sets.</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># automatically determine cell fates if not explicitly provided</span>
    <span class="k">if</span> <span class="n">cell_fates</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">cell_fates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[A-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])))))</span>

    <span class="c1"># _make_subtree_dict functions can only handle 10 cell fates max</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning!&#39;</span><span class="p">)</span>

    <span class="n">quartet_dict</span> <span class="o">=</span> <span class="n">_make_quartet_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>
    <span class="n">doublet_dict</span> <span class="o">=</span> <span class="n">_make_doublet_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>

    <span class="c1"># store result for each rearrangement in dfs list</span>
    <span class="n">dfs_quartets_new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_quartets_true</span> <span class="o">=</span> <span class="n">_make_df_quartets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">quartet_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">df_doublets_true</span> <span class="o">=</span> <span class="n">_make_df_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># rearrange leaves num_resamples times</span>
    <span class="k">for</span> <span class="n">resample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">)):</span>
        <span class="n">doublets_true</span> <span class="o">=</span> <span class="n">_flatten_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">)</span>

        <span class="c1"># shuffle if replacement=False</span>
        <span class="k">if</span> <span class="n">replacement_bool</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">doublets_true</span><span class="p">)</span>

        <span class="n">new_trees</span> <span class="o">=</span> <span class="p">[</span><span class="n">_replace_doublets</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">doublets_true</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span><span class="p">]</span>
        <span class="n">df_quartets_new</span> <span class="o">=</span> <span class="n">_make_df_quartets</span><span class="p">(</span><span class="n">new_trees</span><span class="p">,</span> <span class="n">quartet_dict</span><span class="p">,</span> <span class="n">resample</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">dfs_quartets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_quartets_new</span><span class="p">)</span>

    <span class="n">dfs_c</span> <span class="o">=</span> <span class="n">_process_dfs_quartet</span><span class="p">(</span><span class="n">df_quartets_true</span><span class="p">,</span> <span class="n">dfs_quartets_new</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">quartet_dict</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="n">df_doublets_true</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">quartet_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_c</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.resample.resample_trees_triplets" class="doc doc-heading">
<code class="highlight language-python"><span class="n">resample_trees_triplets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Performs resampling of tree, drawing with or without replacement, returning subtree dictionary and DataFrame containing 
number of triplets across all resamples, the original trees, and the expected number (solved analytically).</p>
<p>Resampling is done via (1) replacing each cell with a randomly chosen singlet across all trees and 
(2) replacing each doublet with a randomly chosen doublet across all trees.
If <code>cell_fates</code> not explicitly provided, use automatically determined cell fates based on tree dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>all_trees_sorted</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing a tree in NEWICK format. 
Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resample datasets.</p></td>
          <td>
                <code>10000</code>
          </td>
        </tr>
        <tr>
          <td><code>replacement_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Sample cells with or without replacement drawing from the pool of all cells.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>cell_fates</code></td>
          <td>
                <code>string or list</code>
          </td>
          <td><p>If 'auto' (i.e. not provided by user), automatically determined 
based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following variables.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>triplet_dict (dict): Keys are triplets, values are integers.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>cell_fates (list): List where each entry is a string representing a cell fate.</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>dfs_c (DataFrame): Indexed by values from <code>triplet_dict</code>.
Last column is analytically solved expected number of each triplet.
Second to last column is observed number of occurences in the original dataset.
Rest of columns are the observed number of occurences in the resampled sets.</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/resample.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">resample_trees_triplets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> 
                            <span class="n">num_resamples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> 
                            <span class="n">replacement_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">cell_fates</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span>
                           <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs resampling of tree, drawing with or without replacement, returning subtree dictionary and DataFrame containing </span>
<span class="sd">    number of triplets across all resamples, the original trees, and the expected number (solved analytically).</span>

<span class="sd">    Resampling is done via (1) replacing each cell with a randomly chosen singlet across all trees and </span>
<span class="sd">    (2) replacing each doublet with a randomly chosen doublet across all trees.</span>
<span class="sd">    If `cell_fates` not explicitly provided, use automatically determined cell fates based on tree dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        all_trees_sorted (list): List where each entry is a string representing a tree in NEWICK format. </span>
<span class="sd">            Trees are sorted to have all triplets in (x,(x,x)) format, and all doublets/quartets in alphabetical order.</span>
<span class="sd">        num_resamples (int, optional): Number of resample datasets.</span>
<span class="sd">        replacement_bool (bool, optional): Sample cells with or without replacement drawing from the pool of all cells.</span>
<span class="sd">        cell_fates (string or list, optional): If &#39;auto&#39; (i.e. not provided by user), automatically determined </span>
<span class="sd">            based on tree dataset. User can also provide list where each entry is a string representing a cell fate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following variables.</span>
<span class="sd">        - triplet_dict (dict): Keys are triplets, values are integers.</span>
<span class="sd">        - cell_fates (list): List where each entry is a string representing a cell fate.</span>
<span class="sd">        - dfs_c (DataFrame): Indexed by values from `triplet_dict`.</span>
<span class="sd">            Last column is analytically solved expected number of each triplet.</span>
<span class="sd">            Second to last column is observed number of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed number of occurences in the resampled sets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># automatically determine cell fates if not explicitly provided</span>
    <span class="k">if</span> <span class="n">cell_fates</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">cell_fates</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;[A-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">])))))</span>

    <span class="c1"># _make_subtree_dict functions can only handle 10 cell fates max</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;warning!&#39;</span><span class="p">)</span>

    <span class="n">triplet_dict</span> <span class="o">=</span> <span class="n">_make_triplet_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>
    <span class="n">doublet_dict</span> <span class="o">=</span> <span class="n">_make_doublet_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>
    <span class="n">cell_dict</span> <span class="o">=</span> <span class="n">_make_cell_dict</span><span class="p">(</span><span class="n">cell_fates</span><span class="p">)</span>

    <span class="c1"># store result for each rearrangement in dfs list</span>
    <span class="n">dfs_triplets_new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_triplets_true</span> <span class="o">=</span> <span class="n">_make_df_triplets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">triplet_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">df_doublets_true</span> <span class="o">=</span> <span class="n">_make_df_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">df_singlets_true</span> <span class="o">=</span> <span class="n">_make_df_singlets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">,</span> <span class="n">cell_dict</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># rearrange leaves num_resamples times</span>
    <span class="k">for</span> <span class="n">resample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">)):</span>
        <span class="n">doublets_true</span> <span class="o">=</span> <span class="n">_flatten_doublets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">)</span>
        <span class="n">singlets_true</span> <span class="o">=</span> <span class="n">_flatten_singlets</span><span class="p">(</span><span class="n">all_trees_sorted</span><span class="p">)</span>

        <span class="c1"># shuffle if replacement=False</span>
        <span class="k">if</span> <span class="n">replacement_bool</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">doublets_true</span><span class="p">)</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">singlets_true</span><span class="p">)</span>

        <span class="c1"># first, replace the doublet with a symbol</span>
        <span class="n">new_trees_1</span> <span class="o">=</span> <span class="p">[</span><span class="n">_replace_doublets_symbol</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_trees_sorted</span><span class="p">]</span>
        <span class="c1"># then, replace all other cells </span>
        <span class="n">new_trees_2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_replace_all</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">singlets_true</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_trees_1</span><span class="p">]</span>
        <span class="c1"># then, replace the symbols</span>
        <span class="n">new_trees_3</span> <span class="o">=</span> <span class="p">[</span><span class="n">_replace_symbols</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">doublets_true</span><span class="p">,</span> <span class="n">replacement_bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_trees_2</span><span class="p">]</span>
        <span class="n">df_triplets_new</span> <span class="o">=</span> <span class="n">_make_df_triplets</span><span class="p">(</span><span class="n">new_trees_3</span><span class="p">,</span> <span class="n">triplet_dict</span><span class="p">,</span> <span class="n">resample</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">dfs_triplets_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_triplets_new</span><span class="p">)</span>

    <span class="n">dfs_c</span> <span class="o">=</span> <span class="n">_process_dfs_triplet</span><span class="p">(</span><span class="n">df_triplets_true</span><span class="p">,</span> <span class="n">dfs_triplets_new</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">triplet_dict</span><span class="p">,</span> <span class="n">doublet_dict</span><span class="p">,</span> <span class="n">cell_dict</span><span class="p">,</span> <span class="n">df_doublets_true</span><span class="p">,</span> <span class="n">df_singlets_true</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">triplet_dict</span><span class="p">,</span> <span class="n">cell_fates</span><span class="p">,</span> <span class="n">dfs_c</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="lma.plot"></a>
  <div class="doc doc-contents first">
  
      <h3 id="lma.plot--lmaplot">lma.plot</h3>
<p>Provides functions for visualizing motif analysis.</p>
<p>This module contains the following functions:</p>
<ul>
<li><code>dfs_for_plotting</code> - Takes DataFrame from resample_trees functions and returns DataFrame for plotting.</li>
<li><code>make_cell_color_dict</code> - Returns cell color dictionary based on provided cell fates.</li>
<li><code>plot_frequency</code> - Displays frequency plot of <code>cutoff</code> number of subtrees in original dataset and all resamples.</li>
<li><code>plot_deviation</code> - Displays deviation plot of <code>cutoff</code> number of subtrees in original dataset and a subset of resamples.</li>
</ul>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="lma.plot.dfs_for_plotting" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dfs_for_plotting</span><span class="p">(</span><span class="n">dfs_c</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts DataFrame from resample_trees functions into DataFrames for plotting.</p>
<p>Calculates z-scores by comparing the observed count in the original trees to the mean/std across all resamples.
Calculates null z-scores by comparing the observed count of <code>num_null</code> random resamples to the mean/std across the rest of 
the resamples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dfs_c</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>Indexed by values from <code>subtree_dict</code>.
Last column is analytically solved expected count of each subtree.
Second to last column is observed count of occurences in the original dataset.
Rest of columns are the observed count of occurences in the resampled sets.
Output from resample_trees functions.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resamples.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>subtree_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are subtrees, values are integers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cutoff</code></td>
          <td>
                <code>string or NoneType or int</code>
          </td>
          <td><p>Take <code>cutoff</code> number of subtrees with largest absolute z-scores 
to include in plots.
If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.
If NoneType, take all subtrees.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>num_null</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Take <code>num_null</code> number of resamples to calculate z-scores as part of null distribution.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following DataFrames.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_true_melt_subset (DataFrame): DataFrame indexed by <code>cutoff</code> number of most significant subtrees for plotting.
Sorted by z-score from most over-represented to most under-represented. Contains the following columns: <ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Count in original trees.</li>
<li>expected (float): Analytically solved expected count.</li>
<li>z-score (float): Computed using observed values and mean/std across resamples.</li>
<li>abs z-score (float): Absolute value of z-score.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>null min (float): Minimum count across across all resamples.</li>
<li>null mean (float): Average count across across all resamples.</li>
<li>null max (float): Maximum count across across all resamples.</li>
<li>adj_p_val (float): Adjusted p-value, one-sided test, corrected using the Bonferonni correction.</li>
<li>null z-score min (float): Minimum z-score across across <code>num_null</code> random resamples.</li>
<li>null z-score mean (float): Average z-score across across <code>num_null</code> random resamples.</li>
<li>null z-score max (float): Maximum z-score across across <code>num_null</code> random resamples.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_melt_subset (DataFrame): Melted DataFrame with observed count for <code>cutoff</code> number of most significant subtrees 
across all resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (int): Counts across all resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_melt_100resamples_subset (DataFrame): Melted DataFrame with observed count for <code>cutoff</code> number of most significant
subtrees across 100 random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (int): Counts across 100 random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_null_zscores_i_c_melt_subset (DataFrame): Melted DataFrame with null z-score for <code>cutoff</code> number of most significant
subtrees across <code>num_null</code> random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Z-scores across <code>num_null</code> random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_null_zscores_i_c_melt_100resamples_subset (DataFrame): Melted DataFrame with null z-score for <code>cutoff</code> number of 
most significant subtrees across 100 random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Z-scores across 100 random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
</ul>
</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">dfs_for_plotting</span><span class="p">(</span><span class="n">dfs_c</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts DataFrame from resample_trees functions into DataFrames for plotting.</span>

<span class="sd">    Calculates z-scores by comparing the observed count in the original trees to the mean/std across all resamples.</span>
<span class="sd">    Calculates null z-scores by comparing the observed count of `num_null` random resamples to the mean/std across the rest of </span>
<span class="sd">    the resamples.</span>

<span class="sd">    Args:</span>
<span class="sd">        dfs_c (DataFrame): Indexed by values from `subtree_dict`.</span>
<span class="sd">            Last column is analytically solved expected count of each subtree.</span>
<span class="sd">            Second to last column is observed count of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed count of occurences in the resampled sets.</span>
<span class="sd">            Output from resample_trees functions.</span>
<span class="sd">        num_resamples (int): Number of resamples.</span>
<span class="sd">        subtree_dict (dict): Keys are subtrees, values are integers.</span>
<span class="sd">        cutoff (string or NoneType or int, optional): Take `cutoff` number of subtrees with largest absolute z-scores </span>
<span class="sd">            to include in plots.</span>
<span class="sd">            If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.</span>
<span class="sd">            If NoneType, take all subtrees.</span>
<span class="sd">        num_null (int, optional): Take `num_null` number of resamples to calculate z-scores as part of null distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following DataFrames.</span>

<span class="sd">        - df_true_melt_subset (DataFrame): DataFrame indexed by `cutoff` number of most significant subtrees for plotting.</span>
<span class="sd">            Sorted by z-score from most over-represented to most under-represented. Contains the following columns: </span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Count in original trees.</span>
<span class="sd">                - expected (float): Analytically solved expected count.</span>
<span class="sd">                - z-score (float): Computed using observed values and mean/std across resamples.</span>
<span class="sd">                - abs z-score (float): Absolute value of z-score.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - null min (float): Minimum count across across all resamples.</span>
<span class="sd">                - null mean (float): Average count across across all resamples.</span>
<span class="sd">                - null max (float): Maximum count across across all resamples.</span>
<span class="sd">                - adj_p_val (float): Adjusted p-value, one-sided test, corrected using the Bonferonni correction.</span>
<span class="sd">                - null z-score min (float): Minimum z-score across across `num_null` random resamples.</span>
<span class="sd">                - null z-score mean (float): Average z-score across across `num_null` random resamples.</span>
<span class="sd">                - null z-score max (float): Maximum z-score across across `num_null` random resamples.</span>
<span class="sd">        - df_melt_subset (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant subtrees </span>
<span class="sd">            across all resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (int): Counts across all resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">        - df_melt_100resamples_subset (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant</span>
<span class="sd">            subtrees across 100 random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (int): Counts across 100 random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">        - df_null_zscores_i_c_melt_subset (DataFrame): Melted DataFrame with null z-score for `cutoff` number of most significant</span>
<span class="sd">            subtrees across `num_null` random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Z-scores across `num_null` random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">        - df_null_zscores_i_c_melt_100resamples_subset (DataFrame): Melted DataFrame with null z-score for `cutoff` number of </span>
<span class="sd">            most significant subtrees across 100 random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Z-scores across 100 random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># slice out the subtrees of the original trees</span>
    <span class="n">df_true_slice</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span>

    <span class="c1"># dataframe of original trees</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">:</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
    <span class="n">df_true_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># slice out the subtrees of the original trees</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;expected&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># dataframe of resampled trees</span>
    <span class="n">resamples</span> <span class="o">=</span> <span class="n">num_resamples</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">resamples</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">df_melt_100resamples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;99&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

    <span class="c1"># calculate zscores</span>
    <span class="n">zscores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_slice</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">zscore</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
        <span class="n">zscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

    <span class="c1"># assign to dataframe and subset based on subtrees with top 10 significance values</span>
    <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;expected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expected</span>
    <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zscores</span>
    <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">])</span>
    <span class="n">df_true_melt</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_true_melt</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># subset based on the number of subtrees</span>
    <span class="k">if</span> <span class="n">cutoff</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">df_true_melt_subset</span> <span class="o">=</span> <span class="n">df_true_melt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">cutoff</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_true_melt_subset</span> <span class="o">=</span> <span class="n">df_true_melt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_true_melt_subset</span> <span class="o">=</span> <span class="n">df_true_melt</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df_true_melt_subset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

    <span class="c1"># subset the resamples</span>
    <span class="n">df_melt_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
        <span class="n">df_melt_subtree</span> <span class="o">=</span> <span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_melt_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df_melt_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_subtree</span><span class="p">)</span>
    <span class="n">df_melt_subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_subset_list</span><span class="p">)</span>

    <span class="n">df_melt_100resamples_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
        <span class="n">df_melt_100resamples_subtree</span> <span class="o">=</span> <span class="n">df_melt_100resamples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_100resamples</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_melt_100resamples_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df_melt_100resamples_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_100resamples_subtree</span><span class="p">)</span>
    <span class="n">df_melt_100resamples_subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_100resamples_subset_list</span><span class="p">)</span>

    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>

    <span class="c1"># calculate p-value (one-sided test)</span>
    <span class="n">adj_p_val_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="n">resamples</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">resamples</span><span class="o">&gt;=</span><span class="n">actual</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">resamples</span><span class="o">&lt;=</span><span class="n">actual</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pos</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">resamples</span><span class="p">)</span>

        <span class="n">p_val</span> <span class="o">=</span> <span class="n">pos</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">resamples</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">)</span>
        <span class="n">adj_p_val_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span>

    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;adj_p_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adj_p_val_list</span>

    <span class="c1"># calculate deviation of each resample</span>
    <span class="n">df_null_zscores_i_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_null</span><span class="p">)):</span>
        <span class="n">df_true_slice_i</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">:</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">df_true_melt_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">df_subset_i</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="p">[</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">])]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_melt_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_subset_i</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

        <span class="n">zscores_i</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_slice_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_melt_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_i</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_melt_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_i</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zscore</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
            <span class="n">zscores_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

        <span class="n">df_null_zscores_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zscores_i</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">df_null_zscores_i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i</span><span class="p">)</span>

    <span class="n">df_null_zscores_i_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">df_null_zscores_i_c_melt</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

    <span class="c1"># subset the resamples</span>
    <span class="n">df_null_zscores_i_c_melt_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
        <span class="n">df_null_zscores_i_c_melt_subtree</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_null_zscores_i_c_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_null_zscores_i_c_melt_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df_null_zscores_i_c_melt_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subtree</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c_melt_subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subset_list</span><span class="p">)</span>

    <span class="c1"># subset the resamples</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples_subset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span><span class="p">)</span>

    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null z-score min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null z-score mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
    <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;null z-score max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt_subset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">df_melt_subset</span><span class="p">,</span> <span class="n">df_melt_100resamples_subset</span><span class="p">,</span> <span class="n">df_null_zscores_i_c_melt_subset</span><span class="p">,</span> <span class="n">df_null_zscores_i_c_melt_100resamples_subset</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.plot.make_color_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make_color_dict</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Makes color dictionary based on provided labels (can be cell types or dataset names).</p>
<p>If cell_fates not provided, use automatically determined cell fates based on tree dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>-</code></td>
          <td>
                <code>labels (list</code>
          </td>
          <td><p>List of string labels.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>-</code></td>
          <td>
                <code>colors (list</code>
          </td>
          <td><p>List of string color codes.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>color_dict</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are labels, values are colors.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_color_dict</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes color dictionary based on provided labels (can be cell types or dataset names).</span>

<span class="sd">    If cell_fates not provided, use automatically determined cell fates based on tree dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        - labels (list): List of string labels.</span>
<span class="sd">        - colors (list): List of string color codes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        color_dict (dict): Keys are labels, values are colors.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">color_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">color_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.plot.multi_dataset_dfs_for_plotting" class="doc doc-heading">
<code class="highlight language-python"><span class="n">multi_dataset_dfs_for_plotting</span><span class="p">(</span><span class="n">dfs_dataset_c</span><span class="p">,</span> <span class="n">dataset_names</span><span class="p">,</span> <span class="n">num_resamples</span><span class="p">,</span> <span class="n">subtree_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts DataFrame from <code>multi_dataset_resample_trees</code> function into DataFrames for plotting.</p>
<p>Calculates z-scores by comparing the observed count in the original trees to the mean/std across all resamples.
Calculates null z-scores by comparing the observed count of <code>num_null</code> random resamples to the mean/std across the rest of 
the resamples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dfs_dataset_c</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a DataFrame with the following characteristics.
Indexed by values from <code>subtree_dict</code>.
Last column is dataset label.
Second to last column is analytically solved expected count of each subtree.
Third to last column is observed count of occurences in the original dataset.
Rest of columns are the observed count of occurences in the resampled sets.
Output from <code>multi_dataset_resample_trees</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_names</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing the dataset label. </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_resamples</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resamples.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>subtree_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are subtrees, values are integers.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cutoff</code></td>
          <td>
                <code>string or NoneType or int</code>
          </td>
          <td><p>Takes <code>cutoff</code> number of subtrees with largest absolute z-scores 
across all datasets to include in plots.
If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1
    in at least one of the datasets provided.
If NoneType, take all subtrees.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>num_null</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Takes <code>num_null</code> number of resamples to calculate z-scores as part of null distribution.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>Contains the following DataFrames.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_true_melt_dataset_label_c_c (DataFrame): DataFrame indexed by <code>cutoff</code> number of most significant subtrees for plotting.
Sorted by z-score from most over-represented to most under-represented (using the most extreme z-score
for each subtree across all datasets provided). Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Count in original trees.</li>
<li>expected (float): Analytically solved expected count.</li>
<li>z-score (float): Computed using observed values and mean/std across resamples.</li>
<li>abs z-score (float): Absolute value of z-score.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>null min (float): Minimum count across across all resamples.</li>
<li>null mean (float): Average count across across all resamples.</li>
<li>null max (float): Maximum count across across all resamples.</li>
<li>adj_p_val (float): Adjusted p-value, one-sided test, corrected using the Bonferonni correction.</li>
<li>dataset (string): Dataset label.</li>
<li>null z-score min (float): Minimum z-score across across <code>num_null</code> random resamples.</li>
<li>null z-score mean (float): Average z-score across across <code>num_null</code> random resamples.</li>
<li>null z-score max (float): Maximum z-score across across <code>num_null</code> random resamples.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_melt_subset_c_c (DataFrame): Melted DataFrame with observed count for <code>cutoff</code> number of most significant subtrees 
across all resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (int): Counts across all resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>dataset (string): Dataset label.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_melt_100resamples_subset_c_c (DataFrame): Melted DataFrame with observed count for <code>cutoff</code> number of most significant
subtrees across 100 random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (int): Counts across 100 random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>dataset (string): Dataset label.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_null_zscores_i_c_melt_subset_c_c (DataFrame): Melted DataFrame with null z-score for <code>cutoff</code> number of most significant
subtrees across <code>num_null</code> random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Z-scores across <code>num_null</code> random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>dataset (string): Dataset label.</li>
</ul>
</li>
</ul></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><ul>
<li>df_null_zscores_i_c_melt_100resamples_subset_c_c (DataFrame): Melted DataFrame with null z-score for <code>cutoff</code> number of 
most significant subtrees across 100 random resamples. Contains the following columns:<ul>
<li>subtree_val (int): Value corresponding to <code>subtree_dict</code>.</li>
<li>observed (float): Z-scores across 100 random resamples.</li>
<li>label (string): Key corresponding to <code>subtree_dict</code>.</li>
<li>dataset (string): Dataset label.</li>
</ul>
</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multi_dataset_dfs_for_plotting</span><span class="p">(</span><span class="n">dfs_dataset_c</span><span class="p">,</span> 
                                   <span class="n">dataset_names</span><span class="p">,</span> 
                                   <span class="n">num_resamples</span><span class="p">,</span> 
                                   <span class="n">subtree_dict</span><span class="p">,</span> 
                                   <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> 
                                   <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts DataFrame from `multi_dataset_resample_trees` function into DataFrames for plotting.</span>

<span class="sd">    Calculates z-scores by comparing the observed count in the original trees to the mean/std across all resamples.</span>
<span class="sd">    Calculates null z-scores by comparing the observed count of `num_null` random resamples to the mean/std across the rest of </span>
<span class="sd">    the resamples.</span>

<span class="sd">    Args:</span>
<span class="sd">        dfs_dataset_c (list): List where each entry is a DataFrame with the following characteristics.</span>
<span class="sd">            Indexed by values from `subtree_dict`.</span>
<span class="sd">            Last column is dataset label.</span>
<span class="sd">            Second to last column is analytically solved expected count of each subtree.</span>
<span class="sd">            Third to last column is observed count of occurences in the original dataset.</span>
<span class="sd">            Rest of columns are the observed count of occurences in the resampled sets.</span>
<span class="sd">            Output from `multi_dataset_resample_trees` function.</span>
<span class="sd">        dataset_names (list): List where each entry is a string representing the dataset label. </span>
<span class="sd">        num_resamples (int): Number of resamples.</span>
<span class="sd">        subtree_dict (dict): Keys are subtrees, values are integers.</span>
<span class="sd">        cutoff (string or NoneType or int, optional): Takes `cutoff` number of subtrees with largest absolute z-scores </span>
<span class="sd">            across all datasets to include in plots.</span>
<span class="sd">            If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1</span>
<span class="sd">                in at least one of the datasets provided.</span>
<span class="sd">            If NoneType, take all subtrees.</span>
<span class="sd">        num_null (int, optional): Takes `num_null` number of resamples to calculate z-scores as part of null distribution.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): Contains the following DataFrames.</span>

<span class="sd">        - df_true_melt_dataset_label_c_c (DataFrame): DataFrame indexed by `cutoff` number of most significant subtrees for plotting.</span>
<span class="sd">            Sorted by z-score from most over-represented to most under-represented (using the most extreme z-score</span>
<span class="sd">            for each subtree across all datasets provided). Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Count in original trees.</span>
<span class="sd">                - expected (float): Analytically solved expected count.</span>
<span class="sd">                - z-score (float): Computed using observed values and mean/std across resamples.</span>
<span class="sd">                - abs z-score (float): Absolute value of z-score.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - null min (float): Minimum count across across all resamples.</span>
<span class="sd">                - null mean (float): Average count across across all resamples.</span>
<span class="sd">                - null max (float): Maximum count across across all resamples.</span>
<span class="sd">                - adj_p_val (float): Adjusted p-value, one-sided test, corrected using the Bonferonni correction.</span>
<span class="sd">                - dataset (string): Dataset label.</span>
<span class="sd">                - null z-score min (float): Minimum z-score across across `num_null` random resamples.</span>
<span class="sd">                - null z-score mean (float): Average z-score across across `num_null` random resamples.</span>
<span class="sd">                - null z-score max (float): Maximum z-score across across `num_null` random resamples.</span>
<span class="sd">        - df_melt_subset_c_c (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant subtrees </span>
<span class="sd">            across all resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (int): Counts across all resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - dataset (string): Dataset label.</span>
<span class="sd">        - df_melt_100resamples_subset_c_c (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant</span>
<span class="sd">            subtrees across 100 random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (int): Counts across 100 random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - dataset (string): Dataset label.</span>
<span class="sd">        - df_null_zscores_i_c_melt_subset_c_c (DataFrame): Melted DataFrame with null z-score for `cutoff` number of most significant</span>
<span class="sd">            subtrees across `num_null` random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Z-scores across `num_null` random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - dataset (string): Dataset label.</span>
<span class="sd">        - df_null_zscores_i_c_melt_100resamples_subset_c_c (DataFrame): Melted DataFrame with null z-score for `cutoff` number of </span>
<span class="sd">            most significant subtrees across 100 random resamples. Contains the following columns:</span>
<span class="sd">                - subtree_val (int): Value corresponding to `subtree_dict`.</span>
<span class="sd">                - observed (float): Z-scores across 100 random resamples.</span>
<span class="sd">                - label (string): Key corresponding to `subtree_dict`.</span>
<span class="sd">                - dataset (string): Dataset label.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df_melt_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_melt_100resamples_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_true_melt_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_null_zscores_i_c_melt_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">):</span>

        <span class="n">dfs_c</span> <span class="o">=</span> <span class="n">dfs_dataset_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dfs_dataset_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_name</span><span class="p">]</span>

        <span class="c1"># slice out the triplets of the original trees</span>
        <span class="n">df_true_slice</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span>

        <span class="c1"># dataframe of original trees</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">:</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
        <span class="n">df_true_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># slice out the triplets of the original trees</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;expected&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="c1"># dataframe of resampled trees</span>
        <span class="n">resamples</span> <span class="o">=</span> <span class="n">num_resamples</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">resamples</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
        <span class="n">df_melt_100resamples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="s1">&#39;99&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

        <span class="n">df_melt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt</span><span class="p">)</span>
        <span class="n">df_melt_100resamples_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_100resamples</span><span class="p">)</span>

        <span class="c1"># calculate zscores</span>
        <span class="n">zscores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_slice</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_slice</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zscore</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
            <span class="n">zscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

        <span class="c1"># assign to dataframe and subset based on subtrees with top 10 significance values</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;expected&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expected</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zscores</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">])</span>
        <span class="n">df_true_melt</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_true_melt</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>

        <span class="c1"># calculate p-value (one-sided test)</span>
        <span class="n">adj_p_val_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;z-score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="n">resamples</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">resamples</span><span class="o">&gt;=</span><span class="n">actual</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">resamples</span><span class="o">&lt;=</span><span class="n">actual</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pos</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">resamples</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">pos</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">resamples</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">)</span>
            <span class="n">adj_p_val_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p_val</span><span class="p">)</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;adj_p_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">adj_p_val_list</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">df_true_melt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_true_melt</span><span class="p">)</span>

        <span class="c1"># calculate deviation of each resample</span>
        <span class="n">df_null_zscores_i_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_null</span><span class="p">)):</span>
            <span class="n">df_true_slice_i</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">:</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                    <span class="s1">&#39;observed&#39;</span><span class="p">:</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">values</span><span class="p">}</span>
            <span class="n">df_true_melt_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">df_subset_i</span> <span class="o">=</span> <span class="n">dfs_c</span><span class="p">[</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">dfs_c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="s1">&#39;expected&#39;</span><span class="p">,</span> <span class="s1">&#39;dataset&#39;</span><span class="p">])]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_melt_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_subset_i</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

            <span class="n">zscores_i</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_true_slice_i</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">actual</span> <span class="o">=</span> <span class="n">df_true_slice_i</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">df_melt_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_i</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">df_melt_i</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_i</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">std</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">zscore</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
                <span class="n">zscores_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zscore</span><span class="p">)</span>

            <span class="n">df_null_zscores_i</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zscores_i</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">df_null_zscores_i_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i</span><span class="p">)</span>

        <span class="n">df_null_zscores_i_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">df_null_zscores_i_c_melt</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,:</span><span class="mi">99</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">)</span>

        <span class="n">df_null_zscores_i_c_melt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="p">)</span>

        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null z-score min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null z-score mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>
        <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;null z-score max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">df_null_zscores_i_c_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]]</span>

    <span class="n">df_true_melt_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_true_melt_list</span><span class="p">)</span>

    <span class="c1"># Loop through each subtree and take the highest absolute z-score across all datasets</span>
    <span class="n">df_true_melt_c_label_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">df_true_melt_c_label</span> <span class="o">=</span> <span class="n">df_true_melt_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_c</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_c_label</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">df_true_melt_c_label</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_true_melt_c_label</span> <span class="o">=</span> <span class="n">df_true_melt_c_label</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_true_melt_c_label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_true_melt_c_label</span><span class="p">)</span>

    <span class="n">df_true_melt_c_label_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_true_melt_c_label_list</span><span class="p">)</span>
    <span class="n">df_true_melt_c_label_c</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Subset based on the cutoff number of subtrees</span>
    <span class="k">if</span> <span class="n">cutoff</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_true_melt_c_label_c</span><span class="p">[</span><span class="s1">&#39;abs z-score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">df_true_melt_c_label_c_subset</span> <span class="o">=</span> <span class="n">df_true_melt_c_label_c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">cutoff</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">df_true_melt_c_label_c_subset</span> <span class="o">=</span> <span class="n">df_true_melt_c_label_c</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_true_melt_c_label_c_subset</span> <span class="o">=</span> <span class="n">df_true_melt_c_label_c</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">cutoff</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">df_true_melt_c_label_c_subset</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Subset the z-score DataFrame based on the cutoff number of subtrees in the DataFrames for each dataset</span>
    <span class="n">df_true_melt_dataset_label_c_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">dataset_names</span><span class="p">:</span>
        <span class="n">df_true_melt_dataset</span> <span class="o">=</span> <span class="n">df_true_melt_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset</span><span class="p">]</span>
        <span class="n">df_true_melt_dataset_label_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_c_label_c_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
            <span class="n">df_true_melt_dataset_label</span> <span class="o">=</span> <span class="n">df_true_melt_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df_true_melt_dataset_label_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_true_melt_dataset_label</span><span class="p">)</span>
        <span class="n">df_true_melt_dataset_label_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_list</span><span class="p">)</span>
        <span class="n">df_true_melt_dataset_label_c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c</span><span class="p">)</span>
    <span class="n">df_true_melt_dataset_label_c_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_list</span><span class="p">)</span>

    <span class="c1"># Subset the melted DataFrames based on the cutoff number of subtrees in the DataFrames for each dataset</span>
    <span class="n">df_melt_subset_c_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_melt_100resamples_subset_c_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_null_zscores_i_c_melt_subset_c_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="p">(</span><span class="n">df_melt</span><span class="p">,</span> 
                <span class="n">df_melt_100resamples</span><span class="p">,</span> 
                <span class="n">df_null_zscores_i_c_melt</span><span class="p">,</span> 
                <span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df_melt_list</span><span class="p">,</span> 
                                                                        <span class="n">df_melt_100resamples_list</span><span class="p">,</span>
                                                                        <span class="n">df_null_zscores_i_c_melt_list</span><span class="p">,</span> 
                                                                        <span class="n">df_null_zscores_i_c_melt_100resamples_list</span><span class="p">)):</span>
        <span class="n">df_melt_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_c_label_c_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
            <span class="n">df_melt_subtree</span> <span class="o">=</span> <span class="n">df_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_melt_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df_melt_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_subtree</span><span class="p">)</span>
        <span class="n">df_melt_subset_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_subset_list</span><span class="p">)</span>
        <span class="n">df_melt_subset_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">df_melt_subset_c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_subset_c</span><span class="p">)</span>

        <span class="n">df_melt_100resamples_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_c_label_c_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
            <span class="n">df_melt_100resamples_subtree</span> <span class="o">=</span> <span class="n">df_melt_100resamples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_melt_100resamples</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_melt_100resamples_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df_melt_100resamples_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_100resamples_subtree</span><span class="p">)</span>
        <span class="n">df_melt_100resamples_subset_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_100resamples_subset_list</span><span class="p">)</span>
        <span class="n">df_melt_100resamples_subset_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">df_melt_100resamples_subset_c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_melt_100resamples_subset_c</span><span class="p">)</span>

        <span class="n">df_null_zscores_i_c_melt_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_c_label_c_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
            <span class="n">df_null_zscores_i_c_melt_subtree</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c_melt</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_null_zscores_i_c_melt</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_null_zscores_i_c_melt_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df_null_zscores_i_c_melt_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subtree</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_subset_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subset_list</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_subset_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">df_null_zscores_i_c_melt_subset_c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subset_c</span><span class="p">)</span>

        <span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df_true_melt_c_label_c_subset</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]:</span>
            <span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span> <span class="o">=</span> <span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_null_zscores_i_c_melt_100resamples</span><span class="p">[</span><span class="s1">&#39;subtree_val&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">subtree_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subtree</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subset_list</span><span class="p">)</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_names</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subset_c</span><span class="p">)</span>

    <span class="n">df_melt_subset_c_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_subset_c_list</span><span class="p">)</span>
    <span class="n">df_melt_100resamples_subset_c_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_melt_100resamples_subset_c_list</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c_melt_subset_c_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_subset_c_list</span><span class="p">)</span>
    <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c_c</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_null_zscores_i_c_melt_100resamples_subset_c_list</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">,</span>
            <span class="n">df_melt_subset_c_c</span><span class="p">,</span> 
            <span class="n">df_melt_100resamples_subset_c_c</span><span class="p">,</span>
            <span class="n">df_null_zscores_i_c_melt_subset_c_c</span><span class="p">,</span>
            <span class="n">df_null_zscores_i_c_melt_100resamples_subset_c_c</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.plot.multi_dataset_plot_deviation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">multi_dataset_plot_deviation</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">dataset_names</span><span class="p">,</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="p">,</span> <span class="n">dataset_color_dict</span><span class="p">,</span> <span class="n">cell_color_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plots deviation of <code>cutoff</code> number of subtrees in multiple datasets.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>subtree</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Type of subtree.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_names</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>List where each entry is a string representing the dataset label. </p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_true_melt_dataset_label_c_c</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>DataFrame with cutoff number of most significant subtrees for plotting.
Sorted by z-score from most over-represented to most under-represented.
Output from <code>multi_dataset_dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dataset_color_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are dataset names, values are colors.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cell_color_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are cell fates, values are colors.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cutoff</code></td>
          <td>
                <code>string or NoneType or int</code>
          </td>
          <td><p>Take <code>cutoff</code> number of subtrees with largest absolute z-scores 
to include in plots.
If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.
If NoneType, take all subtrees.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Title to use for plot. If not provided explicitly, will be automatically determined to read <code>subtree</code> frequency.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Include legend in plot.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_pos</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Position of legend (outside or inside).</p></td>
          <td>
                <code>&#39;outside&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, save figure as file.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>image</code></td>
          <td>
                <code>format (string</code>
          </td>
          <td><p>Format of image file to be saved (png or svg).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dpi</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Resolution of saved image file.</p></td>
          <td>
                <code>300</code>
          </td>
        </tr>
        <tr>
          <td><code>image_save_path</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Path to saved image file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multi_dataset_plot_deviation</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> 
                                 <span class="n">dataset_names</span><span class="p">,</span>
                                 <span class="n">df_true_melt_dataset_label_c_c</span><span class="p">,</span> 
                                 <span class="n">dataset_color_dict</span><span class="p">,</span>
                                 <span class="n">cell_color_dict</span><span class="p">,</span>
                                 <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                 <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                 <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span>
                                 <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                                 <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                                 <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                                 <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots deviation of `cutoff` number of subtrees in multiple datasets.</span>

<span class="sd">    Args:</span>
<span class="sd">        subtree (string): Type of subtree.</span>
<span class="sd">        dataset_names (list): List where each entry is a string representing the dataset label. </span>
<span class="sd">        df_true_melt_dataset_label_c_c (DataFrame): DataFrame with cutoff number of most significant subtrees for plotting.</span>
<span class="sd">            Sorted by z-score from most over-represented to most under-represented.</span>
<span class="sd">            Output from `multi_dataset_dfs_for_plotting` function.</span>
<span class="sd">        dataset_color_dict (dict): Keys are dataset names, values are colors.</span>
<span class="sd">        cell_color_dict (dict): Keys are cell fates, values are colors.</span>
<span class="sd">        cutoff (string or NoneType or int, optional): Take `cutoff` number of subtrees with largest absolute z-scores </span>
<span class="sd">            to include in plots.</span>
<span class="sd">            If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.</span>
<span class="sd">            If NoneType, take all subtrees.</span>
<span class="sd">        title (string, optional): Title to use for plot. If not provided explicitly, will be automatically determined to read `subtree` frequency.</span>
<span class="sd">        legend_bool (bool, optional): Include legend in plot.</span>
<span class="sd">        legend_pos (string, optional): Position of legend (outside or inside).</span>
<span class="sd">        save (bool, optional): If True, save figure as file.</span>
<span class="sd">        image format (string, optional): Format of image file to be saved (png or svg).</span>
<span class="sd">        dpi (int, optional): Resolution of saved image file.</span>
<span class="sd">        image_save_path (string, optional): Path to saved image file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">margins</span><span class="o">=</span><span class="mf">0.05</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">0.23</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">)</span><span class="o">+</span><span class="n">margins</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;No deviation&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">):</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;z-score&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">dataset_color_dict</span><span class="p">[</span><span class="n">dataset</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset</span><span class="p">][</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset</span><span class="p">][</span><span class="s1">&#39;z-score&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">dataset_color_dict</span><span class="p">[</span><span class="n">dataset</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Deviation from resamples&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">legend_bool</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">legend_props</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;outside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;inside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">artist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">findobj</span><span class="p">(</span><span class="n">PathCollection</span><span class="p">)):</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;doublet&#39;</span><span class="p">:</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  
        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">))</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;triplet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.18</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span> 

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">))</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>


    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;quartet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">c4_str</span> <span class="o">=</span> <span class="n">df_true_melt_dataset_label_c_c</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">dataset_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.36</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c4_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c4_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_dataset_label_c_c</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset_names</span><span class="p">))</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">image_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.plot.plot_deviation" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_deviation</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">df_null_zscores_i_c_melt_subset</span><span class="p">,</span> <span class="n">df_null_zscores_i_c_melt_100resamples_subset</span><span class="p">,</span> <span class="n">cell_color_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">multiple_datasets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plots deviation of <code>cutoff</code> number of subtrees in original dataset and <code>num_null</code> resamples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>subtree</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Type of subtree.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_true_melt_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>DataFrame with cutoff number of most significant subtrees for plotting.
Sorted by z-score from most over-represented to most under-represented.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_null_zscores_i_c_melt_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>Melted DataFrame with null z-score for <code>cutoff</code> number of most significant
subtrees across <code>num_null</code> random resamples.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_null_zscores_i_c_melt_100resamples_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>Melted DataFrame with null z-score for <code>cutoff</code> number of 
most significant subtrees across 100 random resamples.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cell_color_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are cell fates, values are colors.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cutoff</code></td>
          <td>
                <code>string or NoneType or int</code>
          </td>
          <td><p>Take <code>cutoff</code> number of subtrees with largest absolute z-scores 
to include in plots.
If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.
If NoneType, take all subtrees.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Title to use for plot. If not provided explicitly, will be automatically determined to read <code>subtree</code> frequency.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>multiple_datasets</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Modify x-axis label depending if single or multiple datasets were used.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_null</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of resamples used to calculate z-scores as part of null distribution.    </p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Include legend in plot.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_pos</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Position of legend (outside or inside).</p></td>
          <td>
                <code>&#39;outside&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, save figure as file.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>image</code></td>
          <td>
                <code>format (string</code>
          </td>
          <td><p>Format of image file to be saved (png or svg).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dpi</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Resolution of saved image file.</p></td>
          <td>
                <code>300</code>
          </td>
        </tr>
        <tr>
          <td><code>image_save_path</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Path to saved image file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_deviation</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> 
                   <span class="n">df_true_melt_subset</span><span class="p">,</span> 
                   <span class="n">df_null_zscores_i_c_melt_subset</span><span class="p">,</span> 
                   <span class="n">df_null_zscores_i_c_melt_100resamples_subset</span><span class="p">,</span> 
                   <span class="n">cell_color_dict</span><span class="p">,</span>
                   <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> 
                   <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                   <span class="n">multiple_datasets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">num_null</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                   <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span>
                   <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                   <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                   <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                   <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots deviation of `cutoff` number of subtrees in original dataset and `num_null` resamples.</span>

<span class="sd">    Args:</span>
<span class="sd">        subtree (string): Type of subtree.</span>
<span class="sd">        df_true_melt_subset (DataFrame): DataFrame with cutoff number of most significant subtrees for plotting.</span>
<span class="sd">            Sorted by z-score from most over-represented to most under-represented.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        df_null_zscores_i_c_melt_subset (DataFrame): Melted DataFrame with null z-score for `cutoff` number of most significant</span>
<span class="sd">            subtrees across `num_null` random resamples.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        df_null_zscores_i_c_melt_100resamples_subset (DataFrame): Melted DataFrame with null z-score for `cutoff` number of </span>
<span class="sd">            most significant subtrees across 100 random resamples.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        cell_color_dict (dict): Keys are cell fates, values are colors.</span>
<span class="sd">        cutoff (string or NoneType or int, optional): Take `cutoff` number of subtrees with largest absolute z-scores </span>
<span class="sd">            to include in plots.</span>
<span class="sd">            If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.</span>
<span class="sd">            If NoneType, take all subtrees.</span>
<span class="sd">        title (string, optional): Title to use for plot. If not provided explicitly, will be automatically determined to read `subtree` frequency.</span>
<span class="sd">        multiple_datasets (bool, optional): Modify x-axis label depending if single or multiple datasets were used.</span>
<span class="sd">        num_null (int, optional): Number of resamples used to calculate z-scores as part of null distribution.    </span>
<span class="sd">        legend_bool (bool, optional): Include legend in plot.</span>
<span class="sd">        legend_pos (string, optional): Position of legend (outside or inside).</span>
<span class="sd">        save (bool, optional): If True, save figure as file.</span>
<span class="sd">        image format (string, optional): Format of image file to be saved (png or svg).</span>
<span class="sd">        dpi (int, optional): Resolution of saved image file.</span>
<span class="sd">        image_save_path (string, optional): Path to saved image file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_true_melt_subset_sg</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;adj_p_val&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">margins</span><span class="o">=</span><span class="mf">0.05</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">0.23</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="o">+</span><span class="n">margins</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                   <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> 
                   <span class="n">data</span><span class="o">=</span><span class="n">df_null_zscores_i_c_melt_subset</span><span class="p">,</span> 
                   <span class="n">cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">inner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#BCBEC0&#39;</span><span class="p">,</span>
                   <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                  <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> 
                  <span class="n">data</span><span class="o">=</span><span class="n">df_null_zscores_i_c_melt_100resamples_subset</span><span class="p">,</span> 
                  <span class="n">jitter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;z-score&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed count&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;null z-score mean&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resampled datasets&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;null z-score mean&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Average across </span><span class="si">{</span><span class="n">num_null</span><span class="si">}</span><span class="s1"> resamples&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;null z-score min&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;null z-score max&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;z-score&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;z-score&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset_sg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Adjusted p-value &lt; 0.05&#39;</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Deviation from resamples&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;z-score&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">legend_bool</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">legend_props</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;outside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;inside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">artist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">findobj</span><span class="p">(</span><span class="n">PathCollection</span><span class="p">)):</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;doublet&#39;</span><span class="p">:</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  
        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;triplet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.18</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span> 

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>


    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;quartet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">c4_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.36</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c4_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c4_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">image_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="lma.plot.plot_frequency" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_frequency</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> <span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">df_melt_subset</span><span class="p">,</span> <span class="n">df_melt_100resamples_subset</span><span class="p">,</span> <span class="n">cell_color_dict</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">multiple_datasets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plots frequency of <code>cutoff</code> number of subtrees in original dataset and all resamples.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>subtree</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Type of subtree.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_true_melt_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>DataFrame with <code>cutoff</code> number of most significant subtrees for plotting.
Sorted by z-score from most over-represented to most under-represented.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_melt_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>Melted DataFrame with observed count for <code>cutoff</code> number of most significant subtrees 
across all resamples.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_melt_100resamples_subset</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td><p>Melted DataFrame with observed count for <code>cutoff</code> number of most significant
subtrees across 100 random resamples.
Output from <code>dfs_for_plotting</code> function.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cell_color_dict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Keys are cell fates, values are colors.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cutoff</code></td>
          <td>
                <code>string or NoneType or int</code>
          </td>
          <td><p>Take <code>cutoff</code> number of subtrees with largest absolute z-scores 
to include in plots.
If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.
If NoneType, take all subtrees.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>title</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Title to use for plot. If not provided explicitly, will be automatically determined to read <code>subtree</code> frequency.</p></td>
          <td>
                <code>&#39;auto&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>multiple_datasets</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Modify x-axis label depending if single or multiple datasets were used.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_bool</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Include legend in plot.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>legend_pos</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Position of legend (outside or inside).</p></td>
          <td>
                <code>&#39;outside&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>save</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, save figure as file.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>image</code></td>
          <td>
                <code>format (string</code>
          </td>
          <td><p>Format of image file to be saved (png or svg).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dpi</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Resolution of saved image file.</p></td>
          <td>
                <code>300</code>
          </td>
        </tr>
        <tr>
          <td><code>image_save_path</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Path to saved image file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>lma/plot.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_frequency</span><span class="p">(</span><span class="n">subtree</span><span class="p">,</span> 
                   <span class="n">df_true_melt_subset</span><span class="p">,</span> 
                   <span class="n">df_melt_subset</span><span class="p">,</span> 
                   <span class="n">df_melt_100resamples_subset</span><span class="p">,</span> 
                   <span class="n">cell_color_dict</span><span class="p">,</span>
                   <span class="n">cutoff</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> 
                   <span class="n">title</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                   <span class="n">multiple_datasets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">legend_bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                   <span class="n">legend_pos</span><span class="o">=</span><span class="s1">&#39;outside&#39;</span><span class="p">,</span>
                   <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                   <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span>
                   <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                   <span class="n">image_save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots frequency of `cutoff` number of subtrees in original dataset and all resamples.</span>

<span class="sd">    Args:</span>
<span class="sd">        subtree (string): Type of subtree.</span>
<span class="sd">        df_true_melt_subset (DataFrame): DataFrame with `cutoff` number of most significant subtrees for plotting.</span>
<span class="sd">            Sorted by z-score from most over-represented to most under-represented.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        df_melt_subset (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant subtrees </span>
<span class="sd">            across all resamples.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        df_melt_100resamples_subset (DataFrame): Melted DataFrame with observed count for `cutoff` number of most significant</span>
<span class="sd">            subtrees across 100 random resamples.</span>
<span class="sd">            Output from `dfs_for_plotting` function.</span>
<span class="sd">        cell_color_dict (dict): Keys are cell fates, values are colors.</span>
<span class="sd">        cutoff (string or NoneType or int, optional): Take `cutoff` number of subtrees with largest absolute z-scores </span>
<span class="sd">            to include in plots.</span>
<span class="sd">            If not provided explicitly, will be automatically determined to take all subtrees with abs z-score &gt; 1.</span>
<span class="sd">            If NoneType, take all subtrees.</span>
<span class="sd">        title (string, optional): Title to use for plot. If not provided explicitly, will be automatically determined to read `subtree` frequency.</span>
<span class="sd">        multiple_datasets (bool, optional): Modify x-axis label depending if single or multiple datasets were used.</span>
<span class="sd">        legend_bool (bool, optional): Include legend in plot.</span>
<span class="sd">        legend_pos (string, optional): Position of legend (outside or inside).</span>
<span class="sd">        save (bool, optional): If True, save figure as file.</span>
<span class="sd">        image format (string, optional): Format of image file to be saved (png or svg).</span>
<span class="sd">        dpi (int, optional): Resolution of saved image file.</span>
<span class="sd">        image_save_path (string, optional): Path to saved image file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_true_melt_subset_sg</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;adj_p_val&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.05</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">margins</span><span class="o">=</span><span class="mf">0.05</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">0.23</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="o">+</span><span class="n">margins</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                   <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> 
                   <span class="n">data</span><span class="o">=</span><span class="n">df_melt_subset</span><span class="p">,</span> 
                   <span class="n">cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">inner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#BCBEC0&#39;</span><span class="p">,</span>
                   <span class="n">scale</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span>
                   <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> 
                  <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> 
                  <span class="n">data</span><span class="o">=</span><span class="n">df_melt_100resamples_subset</span><span class="p">,</span> 
                  <span class="n">jitter</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                  <span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                 <span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed count&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;null mean&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Count across all resamples&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;expected&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Expected count&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;null min&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;null max&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;observed&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_true_melt_subset_sg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Adjusted p-value &lt; 0.05&#39;</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> frequency&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Counts&#39;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">legend_bool</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">legend_props</span> <span class="o">=</span> <span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">family</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;outside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">legend_pos</span> <span class="o">==</span> <span class="s1">&#39;inside&#39;</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_props</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">artist</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">findobj</span><span class="p">(</span><span class="n">PathCollection</span><span class="p">)):</span>
        <span class="n">artist</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;doublet&#39;</span><span class="p">:</span>   
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  
        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">22.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;triplet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.18</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;axes fraction&#39;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span> 

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>


    <span class="k">if</span> <span class="n">subtree</span> <span class="o">==</span> <span class="s1">&#39;quartet&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)):</span>
            <span class="n">c1_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">c2_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">c3_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">c4_str</span> <span class="o">=</span> <span class="n">df_true_melt_subset</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.06</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c1_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c1_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c2_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c2_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>   

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.27</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c3_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c3_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

            <span class="n">x</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.36</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">_make_circle</span><span class="p">(</span><span class="n">cell_color_dict</span><span class="p">[</span><span class="n">c4_str</span><span class="p">],</span> <span class="mf">4.5</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">c4_str</span><span class="p">,</span> 
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> 
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> 
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">annotation_clip</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                        <span class="n">xycoords</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;axes fraction&quot;</span><span class="p">),</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>  

        <span class="k">if</span> <span class="n">cutoff</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;All </span><span class="si">{</span><span class="n">subtree</span><span class="si">}</span><span class="s1"> combinations&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">multiple_datasets</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">subtree</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> combinations </span><span class="se">\n</span><span class="s1">(top </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_true_melt_subset</span><span class="p">)</span><span class="si">}</span><span class="s1"> by abs z-score across all datasets)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">52.5</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fontname&#39;</span><span class="p">:</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">save</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_save_path</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">image_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../mouse_blastocyst/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tutorial 3 - Mouse blastocyst" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Tutorial 3 - Mouse blastocyst
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>